<div class="wrapper-fluid">
  <div class="song-details-container" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.2)), url('<%= cl_image_path @song.photo%>');">
    <div class="song-details-content">
      <h1><%= @song.name %></h1>
      <p> A project by
        <%= link_to user_path(@song.user) do %>
          <%= @song.user["first_name"] %> <%= @song.user["last_name"] %>
        <% end %>
      </p>
      <p class="track-metadata">Made with <i class="fas fa-heart"></i> at <%= @song.bpm %> bpm | <i class="fas fa-clock"></i> <%= @minutes %>:<%= @seconds %> | <i class="fas fa-music"></i> <%= @song.genre.name %></p>
    </div>
  </div>
</div>

<div class="container">
  <div class="player-container">
    <div id="buttons-player">
      <div>
        <div class="player-top">
          <button id="play" disabled><i class="fas fa-play-circle"></i></button>
          <button id="clear">Clear solos</button>
          <%= link_to 'Download Project', @download_link, class: 'btn-download'%>
        </div>
      </div>
    </div>
    <div id="fake-track">
      <%= link_to new_song_track_path(@song.id) do %>
        Add your own track
      <% end %>
    </div>
    <div class="tracks-container">
      <div class="playhead-container">
        <div id="playhead"></div>
      </div>
      <ul class="tracks list-unstyled" id="track-container">
        <% @song_tracks.each do |song_track| %>
          <div class="active-tracks">
            <% if song_track.status != 'pending' %>
              <% @data_url = "https://res.cloudinary.com/dae1kvpyn/" + song_track.track["uploaded_file"] %>
              <% if @song.user == current_user %>
                <li data-url=<%= @data_url %> data-name=<%= song_track.track.description %> class="owner-user-track">
                  <div class="wave-and-butt">
                    <div class="track-description <%= song_track.track.description.downcase %>"> <%= song_track.track.description.capitalize %></div>
                    <canvas class="waveform" width="700px" height="75"></canvas>
                  </div>
                  <div class="solo-mute-btns">
                    <button class="mute"><i class="fas fa-volume-up"></i></button>
                    <button class="solo">S</button>
                  </div>
                  <div class="exit-controls">
                    <div class="track-user-picture">
                      <%= cl_image_tag song_track.track.user.photo, width: 50, height: 50, crop: :fill %>
                      <%= link_to "Delete", song_track_path(song_track), method: :delete, class: 'btn btn-danger' %>
                    </div>
                  </div>
                </li>
              <% elsif song_track.track.user == current_user %>
                <li data-url=<%= @data_url %> data-name=<%= song_track.track.description %> class="current-user-track">
                  <div class="wave-and-butt">
                    <div class="track-description <%= song_track.track.description.downcase %>"> <%= song_track.track.description.capitalize %></div>
                    <canvas class="waveform" width="700px" height="75"></canvas>
                  </div>
                  <div class="solo-mute-btns">
                    <button class="mute"><i class="fas fa-volume-up"></i></button>
                    <button class="solo">S</button>
                  </div>
                  <div class="exit-controls">
                    <div class="track-user-picture">
                      <%= cl_image_tag song_track.track.user.photo, width: 50, height: 50, crop: :fill %>
                    </div>
                    <%= link_to "Delete", song_track_path(song_track), method: :delete, class: 'btn btn-danger' %>
                  </div>
                  </li>
                <% else %>
                  <li data-url=<%= @data_url %> data-name=<%= song_track.track.description %> class="other-user-track">
                    <div class="wave-and-butt">
                      <div class="track-description <%= song_track.track.description.downcase %>"> <%= song_track.track.description.capitalize %></div>
                      <canvas class="waveform" width="700px" height="75"></canvas>
                    </div>
                    <div class="solo-mute-btns">
                      <button class="mute"><i class="fas fa-volume-up"></i></button>
                      <button class="solo">S</button>
                    </div>
                    <div class="track-user-picture">
                      <%= cl_image_tag song_track.track.user.photo, width: 50, height: 50, crop: :fill %>
                    </div>
                  </li>
                <% end %>
              </div>
            <% end %>
          <% end %>
        </ul>
      </div>
      <div class="pending-tracks-container">
        <% if current_user == @song.user %>
          <div class="pending-title">
            pending tracks
          </div>
          <ul class="pending-tracks">
            <% @song_tracks.each do |song_track| %>
              <% if song_track.status == 'pending' %>
                <% @data_url = "https://res.cloudinary.com/dae1kvpyn/" + song_track.track["uploaded_file"] %>
                <li data-url=<%= @data_url %> data-name=<%= song_track.track.description %>>
                  <div class="wave-and-butt">
                    <div class="track-description <%= song_track.track.description.downcase %>"> <%= song_track.track.description.capitalize %></div>
                    <canvas class="waveform" width="700px" height="75"></canvas>
                  </div>
                  <div class="solo-mute-btns">
                  </div>
                  <div class="exit-controls">
                    <div class="track-user-picture">
                      <%= cl_image_tag song_track.track.user.photo, width: 50, height: 50, crop: :fill %>
                      <%= link_to "Listen", song_track_path(song_track), method: :patch, class: 'btn btn-primary' %>
                    </div>
                  </div>
                </li>
              <% end %>
            <% end %>
          </ul>
        <% end %>
      </div>
    </div>
  </div>
</div>
